csharp src/WebSite/Pages/Import.razor
@page "/import"
@inject HttpClient Http

<h3>Import CNAB File</h3>

<div class="mb-3">
    <label class="form-label">CNAB file URL (raw)</label>
    <input class="form-control" @bind="Url" placeholder="https://raw.githubusercontent.com/.../CNAB.txt" />
</div>

<button class="btn btn-primary" @onclick="ImportAsync" disabled="@IsBusy">Import</button>

@if (IsBusy)
{
    <p><em>Importing...</em></p>
}

@if (ResultMessage is not null)
{
    <div class="alert alert-info mt-3">@ResultMessage</div>
}

@code {
    private string Url { get; set; } = "https://raw.githubusercontent.com/ByCodersTec/desafio-ruby-on-rails/master/CNAB.txt";
    private bool IsBusy { get; set; }
    private string? ResultMessage { get; set; }

    private async Task ImportAsync()
    {
        IsBusy = true;
        ResultMessage = null;

        try
        {
            var resp = await Http.PostAsJsonAsync("api/import/from-url", new { Url });
            if (!resp.IsSuccessStatusCode)
            {
                var text = await resp.Content.ReadAsStringAsync();
                ResultMessage = $"Failed: {resp.StatusCode} - {text}";
            }
            else
            {
                var summary = await resp.Content.ReadFromJsonAsync<ImportSummary>();
                ResultMessage = $"Lines: {summary?.TotalLines}, Imported: {summary?.ImportedTransactions}, New Stores: {summary?.NewStores}";
            }
        }
        catch (Exception ex)
        {
            ResultMessage = $"Error: {ex.Message}";
        }
        finally
        {
            IsBusy = false;
        }
    }

    private class ImportSummary
    {
        public int TotalLines { get; set; }
        public int ImportedTransactions { get; set; }
        public int NewStores { get; set; }
    }
}